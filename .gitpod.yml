# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.
image:
  file: .gitpod.Dockerfile

tasks:
  - name: Restore .env file
    before: |
      if [ -f .env ]; then
        # If this workspace already has a .env, don't override it
        # Local changes survive a workspace being opened and closed
        # but they will not persist between separate workspaces for the same repo
        echo "Found .env in workspace"
      else
        if [ -z "${DOTENV}" ]; then
          # There is no $DOTENV from a previous workspace
          # Default to the example .env
          echo "Setting example .env"
          cp .env.example .env
        else
          # After making changes to .env, run this line to persist it to $DOTENV
          #   gp env DOTENV="$(base64 .env | tr -d '\n')"
          #
          # Environment variables set this way are shared between all your workspaces for this repo
          # The lines below will read $DOTENV and print a .env file
          echo "Restoring .env from Gitpod"
          echo "${DOTENV}" | base64 -d > .env
        fi
      fi
  - name: install and start docker
    init: |
      yarn install
      yarn setup
      yarn docker:start
      gp ports await 8080
      gp sync-done setup
  - name: db seed
    init: gp sync-await setup
    command: yarn db-seed-fresh
  - name: yarn start
    init: gp sync-await setup
    command: yarn start

ports:
  - port: 3000
    onOpen: open-preview
  - port: 8080
    onOpen: ignore
  - port: 5432
    onOpen: ignore
  - port: 4566
    onOpen: ignore
